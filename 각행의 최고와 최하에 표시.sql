-- V_STAT_SAMPLE1

/*
  SELECT AREA_CD 
      ,DECODE(GROUPING(AREA_CD)||GROUPING(REGION_AREA),
       '00',MIN(CD_NM),'01',MIN(CD_NM)||'합계','총계') CD_NM
      ,REGION_AREA
      ,NVL(SUM(DECODE(PROD_ID,'100000',SALE_CNT)),0) 
      || DECODE( 
      GROUPING( MAX( SUM(DECODE(PROD_ID,'100000',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100001',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100002',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100003',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100004',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100005',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100006',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100007',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100008',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100009',SALE_CNT))  )
                        
      || GROUPING( MIN( SUM(DECODE(PROD_ID,'100000',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100001',SALE_CNT)) 
                        ,SUM(DECODE(PROD_ID,'100002',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100003',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100004',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100005',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100006',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100007',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100008',SALE_CNT))
                        ,SUM(DECODE(PROD_ID,'100009',SALE_CNT)) B ), '01','MMMMMMMMM','10','IIIIIIIIII', '0000000000') C0
      
      ,NVL(SUM(DECODE(PROD_ID,'100001',SALE_CNT)),0)C1
      ,NVL(SUM(DECODE(PROD_ID,'100002',SALE_CNT)),0)C2
      ,NVL(SUM(DECODE(PROD_ID,'100003',SALE_CNT)),0)C3
      ,NVL(SUM(DECODE(PROD_ID,'100004',SALE_CNT)),0)C4
      ,NVL(SUM(DECODE(PROD_ID,'100005',SALE_CNT)),0)C5
      ,NVL(SUM(DECODE(PROD_ID,'100006',SALE_CNT)),0)C6
      ,NVL(SUM(DECODE(PROD_ID,'100007',SALE_CNT)),0)C7
      ,NVL(SUM(DECODE(PROD_ID,'100008',SALE_CNT)),0)C8
      ,NVL(SUM(DECODE(PROD_ID,'100009',SALE_CNT)),0)C9
      
      ,NVL(SUM(SALE_CNT),0) TOT
      ,GROUPING(AREA_CD)||GROUPING(REGION_AREA) GR
FROM (
  SELECT AREA_CD 
        ,REGION_AREA
        ,PROD_ID
        ,SUM(SALE_CNT) SALE_CNT
  FROM SALE_TBL
  WHERE ROWNUM <=1000000
  GROUP BY AREA_CD 
          ,REGION_AREA
          ,PROD_ID
)A , CD_TBL B
WHERE A.AREA_CD = B.CD_ID
AND   LENGTH(B.CD_ID) = 2 
GROUP BY ROLLUP(AREA_CD,REGION_AREA)       
ORDER BY AREA_CD
        ,REGION_AREA;
*/     

/* 기존의 표에 '▲' '▼' 표시하기, 각행의 최상과 최하에 표시 */

SELECT 
AREA_CD,
CD_NM,
REGION_AREA,
C0 || DECODE(C0, GREATEST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▲') || DECODE(C0, LEAST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▼') C0, -- DECODE를 나눠서 GREATEST, LEAST를 나눠야함 안그러면 동률일 경우의 문제발생
C1 || DECODE(C1, GREATEST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▲') || DECODE(C1, LEAST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▼') C1,
C2 || DECODE(C2, GREATEST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▲') || DECODE(C2, LEAST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▼') C2,
C3 || DECODE(C3, GREATEST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▲') || DECODE(C3, LEAST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▼') C3,
C4 || DECODE(C4, GREATEST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▲') || DECODE(C4, LEAST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▼') C4,
C5 || DECODE(C5, GREATEST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▲') || DECODE(C5, LEAST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▼') C5,
C6 || DECODE(C6, GREATEST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▲') || DECODE(C6, LEAST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▼') C6,
C7 || DECODE(C7, GREATEST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▲') || DECODE(C7, LEAST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▼') C7,
C8 || DECODE(C8, GREATEST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▲') || DECODE(C8, LEAST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▼') C8,
C9 || DECODE(C9, GREATEST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▲') || DECODE(C9, LEAST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9), '▼') C9,
GREATEST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9) G,
LEAST(C0,C1,C2,C3,C4,C5,C6,C7,C8,C9) L
FROM(
  SELECT AREA_CD 
      ,DECODE(GROUPING(AREA_CD)||GROUPING(REGION_AREA),
       '00',MIN(CD_NM),'01',MIN(CD_NM)||'합계','총계') CD_NM
      ,REGION_AREA
      ,NVL(SUM(DECODE(PROD_ID,'100000',SALE_CNT)),0)C0
      ,NVL(SUM(DECODE(PROD_ID,'100001',SALE_CNT)),0)C1
      ,NVL(SUM(DECODE(PROD_ID,'100002',SALE_CNT)),0)C2
      ,NVL(SUM(DECODE(PROD_ID,'100003',SALE_CNT)),0)C3
      ,NVL(SUM(DECODE(PROD_ID,'100004',SALE_CNT)),0)C4
      ,NVL(SUM(DECODE(PROD_ID,'100005',SALE_CNT)),0)C5
      ,NVL(SUM(DECODE(PROD_ID,'100006',SALE_CNT)),0)C6
      ,NVL(SUM(DECODE(PROD_ID,'100007',SALE_CNT)),0)C7
      ,NVL(SUM(DECODE(PROD_ID,'100008',SALE_CNT)),0)C8
      ,NVL(SUM(DECODE(PROD_ID,'100009',SALE_CNT)),0)C9
      ,NVL(SUM(SALE_CNT),0) TOT
      ,GROUPING(AREA_CD)||GROUPING(REGION_AREA) GR
FROM (
  SELECT AREA_CD 
        ,REGION_AREA
        ,PROD_ID
        ,SUM(SALE_CNT) SALE_CNT -- 중간에서 순위를 먹여야 한다. ?? 인라인뷰에서
  FROM SALE_TBL
  WHERE ROWNUM <=1000000
  GROUP BY AREA_CD 
          ,REGION_AREA
          ,PROD_ID
) A , CD_TBL B
WHERE A.AREA_CD = B.CD_ID
AND   LENGTH(B.CD_ID) = 2 
GROUP BY ROLLUP(AREA_CD,REGION_AREA)       
ORDER BY AREA_CD
        ,REGION_AREA
) C
